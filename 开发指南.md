# Magpie 开发指南

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 启动开发环境

方式一：使用开发脚本（推荐）
```bash
npm run dev
```

这会同时启动：
- Vite 开发服务器（端口 5173）
- Electron 应用

方式二：分步启动
```bash
# 终端1：启动Vite开发服务器
npm run dev:renderer

# 终端2：等待上面启动完成后，启动Electron
npm run dev:electron
```

### 3. 构建生产版本

```bash
# 构建前端和后端
npm run build

# 打包应用
npm run package
```

## 项目结构说明

```
magpie/
├── src/
│   ├── main/              # Electron主进程
│   │   └── main.ts        # 主进程入口
│   ├── preload/           # 预加载脚本
│   │   └── preload.ts     # 安全的IPC通信桥接
│   └── renderer/          # React渲染进程（前端）
│       ├── components/    # React组件
│       │   ├── TopBar.tsx
│       │   ├── Sidebar.tsx
│       │   ├── RequestPanel.tsx
│       │   ├── ResponsePanel.tsx
│       │   └── KeyValueEditor.tsx
│       ├── types/         # TypeScript类型定义
│       │   └── index.ts
│       ├── utils/         # 工具函数
│       │   ├── httpClient.ts
│       │   └── helpers.ts
│       ├── styles/        # 样式文件
│       │   └── index.css
│       ├── App.tsx        # 主应用组件
│       └── main.tsx       # React入口
├── dist/                  # 编译输出
├── release/               # 打包输出
├── index.html             # HTML入口
├── package.json           # 项目配置
├── tsconfig.json          # TypeScript配置（渲染进程）
├── tsconfig.main.json     # TypeScript配置（主进程）
└── vite.config.ts         # Vite配置
```

## 功能模块

### 1. HTTP请求核心（httpClient.ts）
- 支持所有HTTP方法
- 环境变量替换
- 请求头管理
- 认证支持（Bearer、Basic、API Key）
- 请求体处理（JSON、Form Data等）

### 2. 请求配置面板（RequestPanel.tsx）
- URL输入
- HTTP方法选择
- 查询参数编辑
- 请求头编辑
- 请求体编辑（多种格式）
- 认证配置

### 3. 响应显示面板（ResponsePanel.tsx）
- 状态码显示
- 响应时间和大小
- 响应体（美化/原始视图）
- 响应头表格

### 4. 侧边栏（Sidebar.tsx）
- 历史记录列表
- 集合管理
- 请求快速加载

### 5. 环境管理（TopBar.tsx）
- 环境切换
- 环境变量配置
- 支持变量替换语法：`{{variable_name}}`

## 开发注意事项

### 环境变量使用
在URL、请求头、请求体中使用环境变量：
```
URL: https://{{base_url}}/api/users
Header: Authorization: Bearer {{api_token}}
Body: {"userId": "{{user_id}}"}
```

### 主进程与渲染进程通信
通过preload.ts暴露的安全API：
```typescript
window.electronAPI.sendRequest(config)
window.electronAPI.saveData(data)
window.electronAPI.loadData()
```

### 添加新功能
1. 在types/index.ts中定义类型
2. 在utils/中添加工具函数
3. 创建或修改components/中的组件
4. 在App.tsx中集成功能
5. 在styles/index.css中添加样式

## 调试技巧

### 1. 打开开发者工具
开发模式下会自动打开，也可以在main.ts中配置：
```typescript
mainWindow.webContents.openDevTools();
```

### 2. 查看控制台日志
- 渲染进程：在开发者工具的Console标签
- 主进程：在终端中查看

### 3. React DevTools
可以安装React DevTools扩展来调试React组件

## 常见问题

### Q: Electron窗口打不开？
A: 确保Vite开发服务器已启动（端口5173），然后再启动Electron

### Q: 样式不生效？
A: 检查src/renderer/main.tsx是否正确导入了styles/index.css

### Q: 跨域问题？
A: Electron环境下不受浏览器跨域限制，可以请求任何API

### Q: 如何修改窗口大小？
A: 在src/main/main.ts的createWindow函数中修改width和height

## 后续扩展建议

1. **数据持久化**：使用electron-store保存集合、历史、环境变量
2. **代码生成**：根据请求生成各语言的代码片段
3. **测试脚本**：添加Pre-request和Test脚本支持
4. **导入导出**：支持Postman集合导入导出
5. **WebSocket**：添加WebSocket测试支持
6. **GraphQL**：添加GraphQL查询支持
7. **主题切换**：支持亮色/暗色主题
8. **国际化**：多语言支持

## 技术支持

如有问题，请查看：
- README.md - 使用说明
- GitHub Issues - 提交问题
- 代码注释 - 查看实现细节

