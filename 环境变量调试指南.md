# 🔍 环境变量功能调试指南

## 📋 **快速检查清单**

如果环境变量没有被替换，请按以下步骤检查：

### ✅ **步骤1：确认已创建环境**
1. 点击左侧栏顶部的"管理"按钮
2. 检查是否有环境在列表中
3. 如果没有，点击"新建"创建一个环境

### ✅ **步骤2：确认已配置变量**
1. 在环境管理器中选择一个环境
2. 在右侧添加变量，例如：
   ```
   变量名: example
   变量值: test123
   ```
3. 确保变量左侧的复选框是**选中**状态（✓）

### ✅ **步骤3：确认已激活环境**
1. 在环境列表中，点击环境右侧的"○"按钮
2. 按钮变成"√"，并显示"激活中"徽章
3. **或者**在左侧栏顶部的环境选择器中选择环境
4. 选择器应该显示：`环境名称 (N 个变量)`

### ✅ **步骤4：正确使用变量格式**
在URL框中，确保变量格式正确：
- ✅ **正确**：`{{example}}`
- ✅ **正确**：`{{ example }}`（允许空格）
- ❌ **错误**：`{example}`（单花括号）
- ❌ **错误**：`{{{example}}}`（三花括号）
- ❌ **错误**：`$example`（美元符号）

### ✅ **步骤5：检查控制台日志**
1. 打开开发者工具（F12）
2. 切换到Console标签页
3. 点击Send按钮发送请求
4. 查看以下日志：

**应该看到的日志：**
```
📤 准备发送请求:
  url: "{{example}}/api/users"
  activeEnvironment: "1698123456789"
  environmentsCount: 1
  activeEnvName: "开发环境"

🔄 开始替换变量:
  text: "{{example}}/api/users"
  activeEnvId: "1698123456789"
  environmentsCount: 1

✅ 找到激活环境: 开发环境 变量数量: 1

✅ 替换变量: {{example}} → test123

🎯 替换后结果: test123/api/users
```

---

## 🐛 **常见问题和解决方案**

### **问题1：看到"❌ 没有激活的环境"**
**原因：** 没有激活任何环境

**解决：**
1. 在环境管理器中点击环境右侧的"○"按钮激活
2. 或在左侧栏顶部的环境选择器中选择环境
3. 确保选择器不是"无环境"

---

### **问题2：看到"❌ 找不到激活的环境"**
**原因：** 环境ID不匹配

**解决：**
1. 重新打开环境管理器
2. 重新激活环境
3. 关闭并重新打开应用

---

### **问题3：变量没有被替换**
**原因：** 可能的原因有多个

**检查项：**
1. **变量是否启用？**
   - 环境管理器中，变量左侧的复选框必须是选中状态（✓）

2. **变量名是否匹配？**
   - 变量名区分大小写
   - `{{Example}}` 和 `{{example}}` 是不同的变量

3. **格式是否正确？**
   - 必须使用双花括号：`{{variableName}}`
   - 不能有拼写错误

---

### **问题4：只有部分变量被替换**
**原因：** 某些变量被禁用或名称不匹配

**解决：**
1. 检查每个变量的启用状态
2. 检查变量名拼写
3. 查看控制台日志，看哪些变量被替换了

---

## 🧪 **调试测试**

### **测试1：基础变量替换**
```
1. 创建环境："测试环境"
2. 添加变量：
   - 变量名: testVar
   - 变量值: hello123
   - 启用: ✓

3. 激活环境
4. 在URL框输入: https://api.example.com/{{testVar}}
5. 打开F12控制台
6. 点击Send

预期控制台输出：
✅ 替换变量: {{testVar}} → hello123
🎯 替换后结果: https://api.example.com/hello123
```

---

### **测试2：多个变量替换**
```
1. 添加多个变量：
   - host = api.example.com
   - version = v2
   - resource = users

2. URL输入: https://{{host}}/{{version}}/{{resource}}

预期结果: https://api.example.com/v2/users
```

---

### **测试3：Headers中使用变量**
```
1. 添加变量：
   - token = abc123xyz

2. 在Headers标签页添加：
   - Key: Authorization
   - Value: Bearer {{token}}

3. 发送请求

预期控制台输出：
✅ 替换变量: {{token}} → abc123xyz
```

---

## 📊 **调试日志说明**

### **发送请求时的日志：**
```
📤 准备发送请求:        # 开始发送请求
  url: "原始URL"         # 替换前的URL
  activeEnvironment: "ID" # 当前激活的环境ID
  environmentsCount: N    # 环境总数
  activeEnvName: "名称"   # 环境名称
```

### **变量替换时的日志：**
```
🔄 开始替换变量:        # 开始替换过程
  text: "原始文本"       # 要替换的文本
  activeEnvId: "ID"      # 环境ID
  environmentsCount: N   # 环境数量

✅ 找到激活环境:        # 成功找到环境
  环境名称              # 环境名
  变量数量: N           # 变量数量

✅ 替换变量:           # 每个被替换的变量
  {{变量名}} → 变量值

🎯 替换后结果:         # 最终结果
  替换后的完整文本
```

---

## 💡 **确保功能正常的完整步骤**

### **完整测试流程：**

**1. 创建环境**
```
点击"管理" → 点击"新建" → 输入"开发环境" → 确认
```

**2. 配置变量**
```
选择"开发环境" → 添加变量：
  变量名: baseUrl
  变量值: http://localhost:3000
  确保左侧复选框是✓
```

**3. 激活环境**
```
方法A: 点击环境右侧的"○"按钮，变成"√"
方法B: 在左侧栏顶部选择器中选择"开发环境"
```

**4. 使用变量**
```
URL框输入: {{baseUrl}}/api/users
```

**5. 发送请求并查看日志**
```
打开F12 → Console标签页 → 点击Send → 查看日志

应该看到：
✅ 找到激活环境: 开发环境 变量数量: 1
✅ 替换变量: {{baseUrl}} → http://localhost:3000
🎯 替换后结果: http://localhost:3000/api/users
```

---

## 🎯 **如果还是不工作**

请提供以下信息：

1. **控制台完整日志** - 从"📤 准备发送请求"到"🎯 替换后结果"的所有日志
2. **环境配置截图** - 环境管理器中的变量列表
3. **URL输入内容** - 您输入的完整URL
4. **环境选择器状态** - 选择器中显示的是什么

这样我可以更准确地帮您定位问题！🔧
