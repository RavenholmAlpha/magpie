# 变量自动补全功能 - 快速测试指南

## 快速测试步骤

### 1. 启动应用
```bash
npm run dev
```

### 2. 创建测试环境

1. 点击左侧边栏顶部的 **"管理"** 按钮
2. 在弹出的环境管理窗口中，点击 **"新建环境"**
3. 输入环境名称：`测试环境`
4. 添加以下变量：

| 变量名 | 变量值 | 启用 |
|--------|--------|------|
| `baseUrl` | `https://jsonplaceholder.typicode.com` | ✓ |
| `userId` | `1` | ✓ |
| `postId` | `1` | ✓ |
| `token` | `test-token-12345` | ✓ |

5. 点击保存

### 3. 激活环境

在左侧边栏顶部的环境选择器中，选择 **"测试环境"**

### 4. 测试 URL 中的变量补全

1. 在 URL 输入框中输入：`{`
2. 应该看到弹出的变量列表，显示所有 4 个变量
3. 使用 ↓ 键选择 `baseUrl`，按 Enter
4. 继续输入：`/posts/{`
5. 选择 `postId`，按 Enter
6. 最终 URL 应该是：`{{baseUrl}}/posts/{{postId}}`
7. 点击 **Send** 按钮
8. 应该成功获取到响应：`https://jsonplaceholder.typicode.com/posts/1` 的数据

### 5. 测试 Headers 中的变量补全

1. 切换到 **Headers** 标签
2. 点击 **Add New** 添加一个新的 Header
3. Key 输入：`Authorization`
4. Value 输入框中输入：`Bearer {`
5. 选择 `token` 变量
6. 最终应该是：`Bearer {{token}}`
7. 点击 Send，检查请求头是否正确发送

### 6. 测试 Params 中的变量补全

1. 切换到 **Params** 标签
2. 添加一个新的参数
3. Key: `userId`
4. Value: 输入 `{`，选择 `userId` 变量
5. 最终应该是：`{{userId}}`

### 7. 测试 Auth 中的变量补全

1. 切换到 **Auth** 标签
2. 选择 **Bearer Token**
3. Token 输入框中输入：`{`
4. 选择 `token` 变量
5. 最终应该是：`{{token}}`

### 8. 测试键盘导航

1. 在任意输入框中输入：`{`
2. 测试以下键盘操作：
   - `↑` `↓` 键：上下选择
   - `Enter` 键：插入选中变量
   - `Esc` 键：关闭列表
   - 再次输入 `{` 并使用 `Tab` 键：也能插入变量

### 9. 测试多个变量

创建一个复杂的 URL：
```
{{baseUrl}}/users/{{userId}}/posts/{{postId}}
```

步骤：
1. 输入 `{` → 选择 `baseUrl`
2. 输入 `/users/{` → 选择 `userId`
3. 输入 `/posts/{` → 选择 `postId`
4. 点击 Send 发送请求

### 10. 测试边界情况

#### 测试 1：没有激活环境
1. 将环境选择器设置为 **"无环境（不使用变量）"**
2. 在 URL 输入框中输入：`{`
3. 应该**不会**弹出补全列表

#### 测试 2：环境没有变量
1. 创建一个新环境，不添加任何变量
2. 激活这个环境
3. 输入 `{`
4. 应该**不会**弹出补全列表

#### 测试 3：所有变量都被禁用
1. 在环境管理中，取消所有变量的勾选
2. 保存后，输入 `{`
3. 应该**不会**弹出补全列表

#### 测试 4：点击外部关闭
1. 输入 `{` 弹出补全列表
2. 点击输入框外的任意位置
3. 补全列表应该关闭

## 预期结果

### ✅ 成功标志

- [x] 输入 `{` 能正确触发补全列表
- [x] 补全列表显示所有已启用的变量
- [x] 变量名称和值正确显示
- [x] 键盘导航正常工作（↑↓ Enter Tab Esc）
- [x] 鼠标点击能选择变量
- [x] 变量以 `{{variableName}}` 格式插入
- [x] 可以在同一字段中使用多个变量
- [x] 发送请求时变量被正确解析
- [x] 在所有支持的位置都能使用补全（URL、Headers、Params、Form Data、Auth）
- [x] 没有激活环境时不显示补全列表
- [x] 点击外部能关闭补全列表

### ❌ 常见问题

如果遇到问题，检查：
1. 环境是否已激活
2. 变量是否已启用（打勾）
3. 是否在正确的输入框中测试
4. 浏览器控制台是否有错误信息

## 性能测试

### 测试大量变量

1. 创建一个包含 50+ 变量的环境
2. 输入 `{` 触发补全
3. 检查：
   - 补全列表是否流畅滚动
   - 键盘导航是否正常
   - 变量插入是否快速

### 测试长变量值

1. 创建变量值很长的变量（如完整的 JWT token）
2. 检查：
   - 变量值是否正确显示（应该被截断）
   - UI 是否保持整洁
   - 悬停时是否能看到完整内容（如果实现了 tooltip）

## 视觉检查

### UI 一致性
- 补全列表的样式与整体应用风格一致
- 颜色和字体符合设计规范
- 选中状态清晰可见
- 动画过渡流畅

### 响应式
- 在不同窗口大小下测试
- 补全列表不应超出屏幕
- 列表应该自适应输入框宽度

## 集成测试

### 完整工作流测试

1. 创建环境 + 变量
2. 使用变量创建完整的 API 请求
3. 保存到 Collection
4. 从 Collection 加载请求
5. 验证变量仍然存在
6. 切换环境
7. 验证变量正确更新
8. 发送请求
9. 验证响应正确

## 回归测试

确保新功能没有破坏现有功能：

- [x] 不使用变量的普通输入仍然正常工作
- [x] 历史记录功能正常
- [x] Collection 功能正常
- [x] 环境管理功能正常
- [x] 代码生成功能正常
- [x] 主题切换功能正常

## 总结

如果所有测试都通过，说明变量自动补全功能已成功实现并可以投入使用！

