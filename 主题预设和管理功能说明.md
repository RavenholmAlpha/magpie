# 主题预设和管理功能说明

## 更新时间
2025-10-24 14:30

## 功能概述

添加了完整的主题管理系统，包括：
- 🎨 6 个精心设计的预设主题
- 💾 保存自定义主题
- 🔄 快速切换主题
- 📝 主题重命名和删除
- 🌈 实时预览主题效果

## 预设主题

### 1. 默认浅色 (Default Light)
```
ID: light
适用场景: 日常使用，清爽明亮
特点: 经典的蓝白配色，适合长时间工作
```

### 2. 深色模式 (Dark Mode)
```
ID: dark
适用场景: 夜间工作，护眼需求
特点: 深色背景，柔和的文字，减少眼睛疲劳
颜色: 深灰背景 + 浅蓝主色调
```

### 3. 护眼模式 (Eye Care)
```
ID: eyecare
适用场景: 长时间编程，保护视力
特点: 绿色系背景，温和舒适
颜色: 浅绿背景 + 绿色主题
```

### 4. 高对比 (High Contrast)
```
ID: highcontrast
适用场景: 需要清晰对比的场景
特点: 纯黑白对比，极高可读性
颜色: 黑白配色 + 纯色状态提示
```

### 5. 紫色主题 (Purple Theme)
```
ID: purple
适用场景: 追求个性化的用户
特点: 优雅的紫色调，现代感强
颜色: 紫色主题 + 浅紫背景
```

### 6. 海洋主题 (Ocean Theme)
```
ID: ocean
适用场景: 喜欢蓝绿色系的用户
特点: 清新的蓝绿色调，舒适放松
颜色: 青蓝色主题 + 浅青背景
```

## 功能特性

### 1. 主题选择器

在主题编辑器顶部，显示所有可用主题：

**功能：**
- 网格布局展示所有主题
- 每个主题显示名称和颜色预览
- 预设主题标记"预设"徽章
- 当前主题高亮显示
- 点击即可切换主题

**视觉：**
```
┌───────────────┐  ┌───────────────┐  ┌───────────────┐
│ 默认浅色 [预设] │  │ 深色模式 [预设] │  │ 我的主题       │
│ ●●●●●        │  │ ●●●●●        │  │ ●●●●● [×]   │
└───────────────┘  └───────────────┘  └───────────────┘
   (当前选中)
```

### 2. 另存为新主题

**操作流程：**
1. 在主题编辑器中修改颜色
2. 点击底部的"💾 另存为"按钮
3. 输入新主题名称
4. 点击"保存"

**结果：**
- 创建新的自定义主题
- 添加到主题列表
- 自动切换到新主题
- 保存到 localStorage

### 3. 修改现有主题

**对于预设主题：**
- 不能直接修改
- 只能"另存为"新主题
- 保护预设主题不被破坏

**对于自定义主题：**
- 可以直接修改颜色
- 点击"✓ 保存并应用"更新主题
- 修改立即生效

### 4. 删除自定义主题

**操作：**
- 悬停在自定义主题上
- 点击右上角的"×"按钮
- 确认删除

**限制：**
- 不能删除预设主题
- 删除当前主题会自动切换到默认主题

### 5. 主题切换

**方式 1：在选择器中点击**
- 立即切换主题
- 实时预览效果
- 不需要保存

**方式 2：保存并应用**
- 修改颜色后点击"保存并应用"
- 更新并切换到修改后的主题

## 技术实现

### 1. 文件结构

```
src/
├── renderer/
│   ├── utils/
│   │   └── themePresets.ts      # 主题预设定义
│   ├── components/
│   │   └── ThemeEditor.tsx      # 主题编辑器（带选择器）
│   └── App.tsx                  # 主题状态管理
```

### 2. 数据存储

**localStorage 存储：**
```javascript
// 当前激活的主题
'magpie-theme': JSON.stringify(theme)

// 所有保存的主题列表（包括预设和自定义）
'magpie-themes': JSON.stringify([...themes])
```

**状态管理：**
```typescript
const [currentTheme, setCurrentTheme] = useState<Theme>()
const [savedThemes, setSavedThemes] = useState<Theme[]>([...themePresets])
```

### 3. 核心函数

#### saveTheme(theme, saveToList)
```typescript
// 保存主题
// saveToList: true - 添加到主题列表
// saveToList: false - 只切换，不添加
```

#### switchTheme(theme)
```typescript
// 切换主题（不添加到列表）
```

#### deleteTheme(themeId)
```typescript
// 删除自定义主题（预设主题不能删除）
```

### 4. 主题ID规则

**预设主题：**
- 固定 ID：`light`, `dark`, `eyecare`, etc.
- 不可修改，不可删除

**自定义主题：**
- 动态 ID：`custom-${timestamp}`
- 可修改，可删除

## 使用指南

### 场景 1：使用预设主题

1. **打开主题编辑器** （点击标题栏主题图标）
2. **浏览预设主题** （顶部选择器）
3. **点击任意主题** （立即切换）
4. **关闭编辑器** （主题已应用）

### 场景 2：创建自定义主题

1. **打开主题编辑器**
2. **选择一个基础主题** （如"默认浅色"）
3. **修改颜色** （调整各个颜色值）
4. **点击"另存为"** （底部左侧按钮）
5. **输入主题名称** （如"我的蓝色主题"）
6. **保存** （主题已创建并应用）

### 场景 3：修改自定义主题

1. **打开主题编辑器**
2. **选择自定义主题** （顶部选择器）
3. **修改颜色**
4. **点击"保存并应用"** （底部右侧按钮）
5. **主题已更新**

### 场景 4：删除不需要的主题

1. **打开主题编辑器**
2. **找到要删除的主题** （自定义主题）
3. **点击主题卡片右上角"×"**
4. **确认删除**

### 场景 5：在多个主题间快速切换

1. **打开主题编辑器**
2. **点击不同主题** （实时切换预览）
3. **找到喜欢的主题**
4. **关闭编辑器** （当前选中的主题已应用）

## UI 设计

### 主题选择器

```
┌─────────────────────────────────────────────────┐
│ 选择主题                                         │
├─────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│ │默认浅色   │  │深色模式   │  │护眼模式   │      │
│ │[预设]    │  │[预设]    │  │[预设]    │      │
│ │●●●●●   │  │●●●●●   │  │●●●●●   │      │
│ └──────────┘  └──────────┘  └──────────┘      │
│                                                 │
│ ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│ │我的主题  │  │紫色主题   │  │蓝色主题   │      │
│ │       [×]│  │       [×]│  │       [×]│      │
│ │●●●●●   │  │●●●●●   │  │●●●●●   │      │
│ └──────────┘  └──────────┘  └──────────┘      │
└─────────────────────────────────────────────────┘
```

**说明：**
- 网格布局，自适应宽度
- 预设主题显示徽章
- 自定义主题显示删除按钮
- 当前主题有高亮边框和背景
- 颜色预览点显示主要颜色

### 主题卡片交互

**普通状态：**
- 白色背景
- 灰色边框
- 显示主题名称和颜色预览

**悬停状态：**
- 蓝色边框
- 轻微向上浮动
- 显示阴影

**激活状态：**
- 蓝色边框
- 浅蓝色背景
- 蓝色外发光

## 数据流

```
用户操作
   ↓
选择/修改主题
   ↓
saveTheme() / switchTheme()
   ↓
更新 state: currentTheme, savedThemes
   ↓
applyTheme() - 应用 CSS 变量
   ↓
localStorage - 持久化存储
   ↓
界面实时更新
```

## 键盘快捷键（未来）

可以考虑添加：
- `Ctrl/Cmd + 1-6` - 快速切换前6个主题
- `Ctrl/Cmd + T` - 打开主题编辑器
- `Ctrl/Cmd + S` - 保存主题
- `Ctrl/Cmd + Shift + S` - 另存为

## 最佳实践

### 1. 主题命名

**推荐：**
- ✅ "我的蓝色主题"
- ✅ "工作用深色"
- ✅ "周末浅色"

**不推荐：**
- ❌ "主题1"
- ❌ "测试"
- ❌ "新建主题"

### 2. 主题组织

**建议：**
- 为不同场景创建主题（工作、休闲、夜间）
- 定期清理不用的主题
- 保留3-5个常用主题即可

### 3. 颜色调整

**技巧：**
- 从预设主题开始，微调到自己喜欢的样子
- 保持足够的对比度，确保可读性
- 测试所有功能区域，确保颜色协调

## 故障排查

### 问题 1：主题没有保存

**可能原因：**
- localStorage 被禁用
- 浏览器隐私模式

**解决方法：**
- 检查浏览器设置
- 允许 localStorage
- 退出隐私模式

### 问题 2：删除按钮不显示

**原因：**
- 这是预设主题，不能删除

**说明：**
- 只有自定义主题可以删除
- 预设主题用于保证始终有可用主题

### 问题 3：主题切换后颜色不对

**可能原因：**
- CSS 变量没有正确应用
- 缓存问题

**解决方法：**
- 刷新页面（F5）
- 清除浏览器缓存
- 重新选择主题

## 性能优化

### 1. 主题列表

- 懒加载预览图（如果添加）
- 虚拟滚动（当主题数量 > 20）
- 防抖搜索（如果添加搜索功能）

### 2. 颜色应用

- 使用 CSS 变量，无需重新渲染组件
- 批量更新，一次性应用所有颜色
- 避免频繁的 DOM 操作

### 3. 存储优化

- 定期清理无效主题
- 压缩存储数据
- 增量更新而非全量保存

## 统计数据

### 功能完整性

| 功能 | 状态 | 备注 |
|------|------|------|
| 预设主题 | ✅ | 6 个主题 |
| 主题选择器 | ✅ | 网格布局 |
| 主题切换 | ✅ | 实时预览 |
| 保存主题 | ✅ | localStorage |
| 另存为 | ✅ | 创建新主题 |
| 删除主题 | ✅ | 仅自定义 |
| 主题预览 | ✅ | 颜色点 |
| 持久化 | ✅ | 本地存储 |

### 代码统计

- **新增文件：** 1 个（themePresets.ts）
- **修改文件：** 3 个
- **新增代码：** ~400 行
- **新增样式：** ~150 行
- **预设主题：** 6 个

## 未来改进

### 短期计划

1. **主题搜索**
   - 搜索框
   - 按名称过滤
   - 按颜色标签过滤

2. **主题导入/导出**
   - 导出为 JSON 文件
   - 从文件导入主题
   - 分享主题给他人

3. **主题预览图**
   - 生成主题截图
   - 更直观的预览
   - 缩略图模式

### 长期计划

1. **在线主题商店**
   - 社区分享主题
   - 下载流行主题
   - 评分和评论

2. **AI 配色**
   - 基于图片生成主题
   - 智能配色建议
   - 自动生成配色方案

3. **主题调度**
   - 按时间自动切换
   - 跟随系统主题
   - 自定义规则

## 总结

通过这次更新：

✅ **完整的主题系统**
- 6 个精心设计的预设主题
- 灵活的自定义主题管理
- 直观的主题切换体验

✅ **用户体验提升**
- 一键切换主题
- 实时预览效果
- 简单易用的界面

✅ **数据持久化**
- 自动保存主题
- 跨会话保留设置
- 可靠的存储机制

现在用户可以：
- 🎨 从 6 个预设主题中选择
- 💾 创建和保存无限个自定义主题
- 🔄 一键快速切换主题
- 📝 管理（重命名、删除）自己的主题
- 🌈 实时预览主题效果

享受个性化的 Magpie 体验吧！✨

