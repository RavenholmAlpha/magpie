# 💻 开发指南

## 开发环境设置

### 前置要求

- **Node.js**: 16.x 或更高版本
- **npm**: 8.x 或更高版本
- **Git**: 任意版本

### 克隆项目

```bash
git clone https://github.com/yourusername/magpie.git
cd magpie
```

### 安装依赖

```bash
npm install
```

如果下载慢，可以使用国内镜像：
```bash
npm install --registry=https://registry.npmmirror.com
```

### 启动开发环境

```bash
npm run dev
```

这会同时启动：
- Vite 开发服务器（前端）
- Electron 应用（桌面应用）

## 项目结构

```
magpie/
├── src/
│   ├── main/              # Electron 主进程
│   │   ├── main.ts       # 主进程入口，窗口管理
│   │   └── store.ts      # 数据持久化（electron-store）
│   │
│   ├── preload/          # 预加载脚本
│   │   └── preload.ts    # 主进程与渲染进程通信桥接
│   │
│   └── renderer/         # React 渲染进程
│       ├── components/   # React 组件
│       │   ├── TitleBar.tsx           # 自定义标题栏
│       │   ├── TopBar.tsx             # 顶部工具栏
│       │   ├── Sidebar.tsx            # 侧边栏
│       │   ├── RequestPanel.tsx       # 请求面板
│       │   ├── ResponsePanel.tsx      # 响应面板
│       │   ├── CollectionBlock.tsx    # 集合管理
│       │   ├── HistoryList.tsx        # 历史列表
│       │   ├── EnvironmentManager.tsx # 环境管理器
│       │   ├── ThemeEditor.tsx        # 主题编辑器
│       │   ├── CodeGenerator.tsx      # 代码生成器
│       │   ├── KeyValueEditor.tsx     # 键值对编辑器
│       │   ├── VariableAutocomplete.tsx # 变量补全
│       │   ├── InputModal.tsx         # 输入模态框
│       │   └── ColorPicker.tsx        # 颜色选择器
│       │
│       ├── hooks/        # 自定义 Hooks
│       │   └── useResizable.ts        # 可调整大小
│       │
│       ├── types/        # TypeScript 类型定义
│       │   └── index.ts
│       │
│       ├── utils/        # 工具函数
│       │   ├── httpClient.ts          # HTTP 客户端
│       │   ├── helpers.ts             # 辅助函数
│       │   ├── codeGenerator.ts       # 代码生成
│       │   ├── importExport.ts        # 导入导出
│       │   └── themePresets.ts        # 主题预设
│       │
│       ├── styles/       # 样式文件
│       │   ├── index.css              # 全局样式
│       │   └── titlebar.css           # 标题栏样式
│       │
│       ├── App.tsx       # 主应用组件
│       └── main.tsx      # React 入口
│
├── public/               # 静态资源
├── build/icons/          # 应用图标
├── package.json          # 项目配置
├── vite.config.ts        # Vite 配置
└── tsconfig.json         # TypeScript 配置
```

## 可用脚本

| 命令 | 说明 |
|------|------|
| `npm run dev` | 启动开发环境（推荐） |
| `npm run dev:renderer` | 仅启动渲染进程开发服务器 |
| `npm run dev:electron` | 仅启动 Electron 主进程 |
| `npm run build` | 构建生产版本 |
| `npm run build:renderer` | 构建渲染进程 |
| `npm run build:electron` | 构建主进程 |
| `npm run package` | 打包为可执行文件 |
| `npm run package:win` | 仅打包 Windows 版本 |
| `npm run package:mac` | 仅打包 macOS 版本 |
| `npm run package:linux` | 仅打包 Linux 版本 |
| `npm start` | 运行已构建的应用 |

## 核心模块说明

### HTTP 客户端（httpClient.ts）

负责发送 HTTP 请求和处理响应：

```typescript
// 发送请求
export async function sendRequest(
  request: RequestConfig,
  environments: Environment[],
  activeEnvId: string | null
): Promise<ResponseData>
```

**功能:**
- 环境变量替换
- 请求头处理
- 认证配置
- 请求体编码
- 响应时间统计

### 数据存储（store.ts）

使用 electron-store 实现数据持久化：

```typescript
// 保存和读取数据
store.get('collections')
store.set('collections', data)
```

**存储内容:**
- 集合（Collections）
- 环境（Environments）
- 历史记录（History）
- 主题设置（Theme）
- 上次请求（Last Request）

### 代码生成（codeGenerator.ts）

生成各种语言的 HTTP 请求代码：

```typescript
export function generateCurl(request: RequestConfig): string
export function generateJavaScript(request: RequestConfig): string
export function generatePython(request: RequestConfig): string
export function generateNodeJs(request: RequestConfig): string
```

## 开发规范

### TypeScript

- 使用严格模式
- 避免使用 `any` 类型
- 为所有函数添加类型注解
- 使用 interface 定义复杂类型

### React 组件

- 使用函数式组件
- 使用 TypeScript 定义 Props
- 遵循单一职责原则
- 使用 `useCallback` 和 `useMemo` 优化性能

### 代码风格

- 使用 2 空格缩进
- 使用分号
- 使用单引号（JSX 中除外）
- 组件名使用 PascalCase
- 函数名使用 camelCase

### 提交规范

使用 [Conventional Commits](https://www.conventionalcommits.org/) 格式：

```bash
feat: 添加新功能
fix: 修复问题
docs: 更新文档
style: 代码格式调整
refactor: 重构代码
perf: 性能优化
test: 添加测试
chore: 构建/工具变更
```

## 调试

### 渲染进程调试

1. 打开开发者工具（Ctrl+Shift+I 或 F12）
2. 使用 Console 查看日志
3. 使用 Network 查看网络请求
4. 使用 Elements 检查 DOM
5. 使用 Sources 设置断点

### 主进程调试

在终端查看主进程日志输出。

### 常见问题

**Q: 端口冲突？**  
A: Vite 会自动选择其他端口（5174、5175 等）

**Q: 热更新不工作？**  
A: 检查 Vite 开发服务器是否正常运行

**Q: Electron 窗口空白？**  
A: 确保 Vite 开发服务器已启动

## 构建发布

### 构建应用

```bash
npm run build
```

### 打包应用

```bash
# Windows
npm run package:win

# macOS（需要在 macOS 上运行）
npm run package:mac

# Linux
npm run package:linux

# 所有平台
npm run package:all
```

### 发布到 GitHub

查看 [GitHub 发布指南](./GitHub发布指南.md) 了解详细步骤。

## 贡献

### 如何贡献

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'feat: Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

### 贡献类型

- 🐛 Bug 修复
- ✨ 新功能
- 📝 文档改进
- 🎨 UI/UX 改进
- ⚡ 性能优化
- 🧪 测试

详见 [CONTRIBUTING.md](../CONTRIBUTING.md)

## 技术支持

- 📖 [GitHub Issues](https://github.com/yourusername/magpie/issues) - 报告问题
- 💬 [GitHub Discussions](https://github.com/yourusername/magpie/discussions) - 讨论交流
- 📧 Email: magpie@example.com

---

**Happy Coding!** 🚀

